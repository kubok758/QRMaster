<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>QRM ‚Äî QR-Master</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>

<style>
/* === –û–°–ù–û–í–ê === */
:root {
    --glass-bg: rgba(255,255,255,.25);
    --glass-border: 1px solid rgba(255,255,255,.4);
    --glass-shadow: 0 8px 32px rgba(31,38,135,.15);
    --primary-gradient: linear-gradient(135deg,#667eea,#764ba2);
    --radius-xl: 24px;
    --radius-md: 16px;
}

* { box-sizing: border-box; }

body {
    margin: 0;
    min-height: 100vh;
    font-family: Montserrat, sans-serif;
    background: linear-gradient(45deg,#a18cd1,#fbc2eb);
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
}

.container {
    width: 100%;
    max-width: 460px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border-radius: var(--radius-xl);
    border: var(--glass-border);
    box-shadow: var(--glass-shadow);
    overflow: hidden;
}

/* === –¢–ê–ë–´ === */
.tabs {
    display: flex;
}

.tab {
    flex: 1;
    padding: 18px;
    border: none;
    background: transparent;
    font-weight: 700;
    cursor: pointer;
}

.tab.active {
    background: var(--primary-gradient);
    color: #fff;
}

/* === –ö–û–ù–¢–ï–ù–¢ === */
.content {
    display: none;
    padding: 25px;
    gap: 20px;
    flex-direction: column;
    min-height: 420px;
}

.content.active {
    display: flex;
}

label {
    font-weight: 700;
    font-size: 14px;
}

input, select {
    width: 100%;
    padding: 16px;
    border-radius: var(--radius-md);
    border: var(--glass-border);
    font-size: 16px;
}

button.btn {
    padding: 16px;
    font-size: 18px;
    font-weight: 700;
    border-radius: var(--radius-md);
    border: none;
    cursor: pointer;
    background: var(--primary-gradient);
    color: #fff;
}

button.btn-outline {
    background: rgba(255,255,255,.7);
    color: #333;
    border: 1px solid rgba(0,0,0,.1);
}

/* === QR === */
#qrcode-container {
    display: none;
    align-items: center;
    flex-direction: column;
    gap: 15px;
}

#qrcode img, #qrcode canvas {
    background: #fff;
    padding: 10px;
    border-radius: 10px;
}

/* === –°–ö–ê–ù–ï–† === */
#reader {
    width: 100%;
    min-height: 280px;
    border-radius: var(--radius-md);
    overflow: hidden;
    position: relative;
}

#reader video {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
}

#camera-status {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: #666;
}

.scan-options {
    display: flex;
    gap: 10px;
}

.scan-btn-small {
    flex: 1;
    padding: 14px;
    border-radius: var(--radius-md);
    border: var(--glass-border);
    background: rgba(255,255,255,.6);
    font-weight: 700;
    cursor: pointer;
}

.scan-btn-small.active-mode {
    background: #fff;
    color: #764ba2;
}

/* === –†–ï–ó–£–õ–¨–¢–ê–¢ === */
#scan-result {
    display: none;
    text-align: center;
    gap: 15px;
    flex-direction: column;
}
</style>
</head>

<body>

<div class="container">

<div class="tabs">
    <button class="tab active" onclick="switchTab('create')">–°–æ–∑–¥–∞—Ç—å QR</button>
    <button class="tab" onclick="switchTab('scan')">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
</div>

<!-- –°–û–ó–î–ê–ù–ò–ï -->
<div id="create" class="content active">
    <label>–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö</label>
    <select id="qr-type" onchange="updatePlaceholder()">
        <option value="text">–¢–µ–∫—Å—Ç</option>
        <option value="url">–°—Å—ã–ª–∫–∞</option>
        <option value="wifi">Wi-Fi</option>
    </select>

    <label>–î–∞–Ω–Ω—ã–µ</label>
    <input id="qr-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç">

    <button class="btn" onclick="generateQR()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>

    <div id="qrcode-container">
        <div id="qrcode"></div>
        <button class="btn" onclick="downloadQR()">–°–∫–∞—á–∞—Ç—å</button>
    </div>
</div>

<!-- –°–ö–ê–ù–ï–† -->
<div id="scan" class="content">

    <div class="scan-options">
        <button id="cam-btn" class="scan-btn-small" onclick="startCamera()">üì∑ –ö–∞–º–µ—Ä–∞</button>
        <button id="file-btn" class="scan-btn-small" onclick="openFile()">üñº –§–æ—Ç–æ</button>
        <input type="file" id="file-input" accept="image/*" hidden>
    </div>

    <div id="reader">
        <div id="camera-status">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º</div>
    </div>

    <div id="scan-result">
        <div id="result-text"></div>
        <button class="btn" onclick="copyResult()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <a id="open-link" class="btn" target="_blank" style="display:none">–û—Ç–∫—Ä—ã—Ç—å</a>
        <button class="btn-outline" onclick="resetScanner()">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –µ—â—ë</button>
    </div>
</div>

</div>

<script>
let qr = new QRCode(document.getElementById("qrcode"), { width: 300, height: 300 });
let scanner = null;

function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));

    if (tab === 'create') {
        document.querySelectorAll('.tab')[0].classList.add('active');
        document.getElementById('create').classList.add('active');
        stopCamera();
    } else {
        document.querySelectorAll('.tab')[1].classList.add('active');
        document.getElementById('scan').classList.add('active');
    }
}

function updatePlaceholder() {
    const t = document.getElementById('qr-type').value;
    document.getElementById('qr-input').placeholder =
        t === 'url' ? 'https://site.com' :
        t === 'wifi' ? 'WIFI:S:Name;T:WPA;P:pass;;' :
        '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç';
}

function generateQR() {
    const text = qrInput.value.trim();
    if (!text) return alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ');
    qr.clear();
    qr.makeCode(text);
    qrcodeContainer.style.display = 'flex';
}

function downloadQR() {
    const img = qrcode.querySelector('img') || qrcode.querySelector('canvas');
    const url = img.src || img.toDataURL();
    const a = document.createElement('a');
    a.href = url;
    a.download = 'qr.png';
    a.click();
}

/* === –°–ö–ê–ù–ï–† === */

function startCamera() {
    resetScanner();
    if (!scanner) scanner = new Html5Qrcode("reader");
    scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        onScan
    ).then(() => cameraStatus.textContent = '')
     .catch(() => cameraStatus.textContent = '–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞');
}

function stopCamera() {
    if (scanner?.isScanning) scanner.stop();
}

function onScan(text) {
    stopCamera();
    reader.style.display = 'none';
    scanResult.style.display = 'flex';
    resultText.textContent = text;

    if (/^https?:\/\//i.test(text)) {
        openLink.href = text;
        openLink.style.display = 'block';
    } else {
        openLink.style.display = 'none';
    }
}

function resetScanner() {
    scanResult.style.display = 'none';
    reader.style.display = 'block';
    resultText.textContent = '';
    cameraStatus.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º';
}

function openFile() {
    fileInput.click();
}

fileInput.onchange = () => {
    if (!scanner) scanner = new Html5Qrcode("reader");
    scanner.scanFile(fileInput.files[0], true)
        .then(onScan)
        .catch(() => alert('QR –Ω–µ –Ω–∞–π–¥–µ–Ω'));
};

function copyResult() {
    navigator.clipboard.writeText(resultText.textContent);
    alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ');
}
</script>

</body>
</html>
